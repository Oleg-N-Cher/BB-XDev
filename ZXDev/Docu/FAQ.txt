FAQ
===

Q. Информационная поддержка ZXDev. Куда задавать вопросы?

A. Есть форум: http://zx.oberon2.ru/forum/viewforum.php?f=10
   Есть группа в Телеграм: t.me/zxdev_masters

--------------------------------------------------------------------------------

Q. Где можно ознакомиться с функциями, ключевыми словами и вообще синтаксисом
как для самого Оберона, так и для подключаемых библиотек, например, с Бейсиком
(которые IMPORT B := Basic)?

A. Оберона - читайте приложенные доки в ZXDev/Docu - например, o2rus.mht,
конечно не учебник, но кое-что. Есть торрент-раздача книг и статей по Оберону:
http://nnmclub.to/forum/viewtopic.php?t=746187

Библиотеки находятся в ZXDev/Lib. Чтобы узнать какие именно есть процедуры,
константы и типы - выделите мышкой название библиотеки (дабл кликом) и выберите
из меню XDev -> Show Definition

--------------------------------------------------------------------------------

Q. Типы переменных: почему у меня не получилось, например, скомпилировать 
"FOR x := 0 TO 7 BY 1 DO B.BORDER (x);B.CLS",
когда x был переменной типа INTEGER и SHORTINT, но получилось с типом BYTE?

A. Оберон требует явной инструкции SHORT для уменьшения мощности числового типа,
чтобы было видно, где именно возможны потери разрядности.

  Для SHORTINT {-32768..32767} нужно так: B.BORDER (SHORT(x))
  Для INTEGER {-2147483648..2147483647} нужно так: B.BORDER (SHORT(SHORT(x)))

Заметьте, эти усечения мощности типа действительно несут накладные расходы.
В Си это маскируется, в Обероне же нужно прописывать явно.

Типами INTEGER и LONGINT пользоваться вообще не советую - они неэффективны
на Z80. Хотя INTEGER может иметь смысл в некоторых случаях.

--------------------------------------------------------------------------------

Q. Как создать новый проект?

A. Для начала убедимся, что у нас установлена системная переменная XDev.
Правой кнопкой на Компьютер -> Свойства -> Дополнительные параметры системы,
кнопка Переменные среды. Системные переменные -> Создать

Имя переменной: XDev
Значение переменной: Путь_к_XDev (без пробелов). Например: d:\Projects\XDev

Это в Windows 7. В других - по аналогии.

  - Создаём папку для проекта (где угодно).

  - Создаём и сохраним в корне папки проекта (или в подпапке /Mod)
главный модуль, который будет выглядеть примерно так:

MODULE MyProj; (*$MAIN*)
END MyProj.

  - Откроем его в XDev, выберем из меню XDev => ZXDev Project Setup,
настроим свойства проекта (или оставим их без изменений), сохраним
(кнопка Save). Среда создаст папку Bin и сборочные скрипты.

    - Адреса данных и кода должны быть разумными, иначе SDCC заругается.
    - Target сейчас бывает только TAP и REM, остальные в планах.
    - Главный модуль задаётся в поле Main Module без .rel и без .Mod, просто имя.
    - Не главные модули, напротив, перечислены: имя.rel, главный же модуль
в этот список НЕ входит.
    - Свойства Include и Libraries, скорее всего, не понадобятся вам ещё долго.
    - Поле SDCC Options вам, скорее всего, тоже вряд ли понадобится очень скоро.
Может понадобиться опция --reserve-regs-iy, которая запрещает SDCC занимать
регистр IY для любых применений, иногда это может быть полезно.
    - Поле Ofront+.par позволяет задать свойства транслятора Оберона в Си.
Например, можно смешивать пять разных диалектов в одном проекте. Пример:

      -s3 -21 Main.Mod -2 MyMod.Mod -C Mod7.Mod -7

        -s это указание разрешения перегенерировать символьники
        -3 это диалект Оберона, в данном случае Оберон-3
        -21 это задание размера адреса (2 байта) и логического типа SET (1 байт)
        Main на Обероне-2, MyMod на Компонентном Паскале, а Mod7 - на Обероне-07
        (подробнее об этих опциях смотрите в документации по Ofront)

    - Run это запуск собранной программы в эмуляторе, ассоциированном
с расширением .tap
    - Clean это уборка, удаление временных файлов, нужных для сборки проекта.

  - Например, добавим к нашей программе библиотеку Basic. Для этого
создадим в папке проекта подпапку Sym и перенесём в неё файл
ZXDev/Lib/Sym/Basic.sym

MODULE MyProj; (*$MAIN*)
IMPORT b := Basic;
BEGIN
  b.BORDER(b.Yellow)
END MyProj.

  - Для многомодульного проекта надо перечислить все модули в поле Module.
И указать, какой из них главный (Main Module).

  - Ну и ещё могут быть другие тонкости, скажем, с режимом работы нашей
программы (DI, IM 1, IM 2) - это конфигурируется в специальных конфигах.
Для конфигурирования библиотеки Basic нужно положить в Obj или в Lib/Obj
файл BasicCfg.h. Файл XDevCfg.h тоже нужен. Если их не положить - будут
использованы конфигурационные файлы по умолчанию. То есть, их есть смысл
использовать, если конфигурация проекта отличается от дефолтной.

--------------------------------------------------------------------------------

Q. Как написать свой модуль на ассемблере?

A. Модуль на ассемблере выглядит так же, как и не на ассемблере. На уровне
модуля на ассемблере пишутся отдельные процедуры. Пишем:

IMPORT Asm; (* Для краткости можно: IMPORT a := Asm; *)

PROCEDURE MyAsm;
BEGIN
  Asm.code("CALL 0xD6B"); (* a.code("CALL 0xD6B"); *)
END MyAsm;

--------------------------------------------------------------------------------

Q. Как добавить новый модуль в проект?

A. В исходнике:

MODULE MyNewMod1;

Меню XDev => ZXDev Project Setup => Modules

Было: MyMod1.rel MyMod2.rel MyMod3.rel
Стало: MyMod1.rel MyMod2.rel MyMod3.rel MyNewMod1.rel

Да, называть файл модуля следует так же, как и имя модуля (после MODULE), чтобы
потом не удивляться.

--------------------------------------------------------------------------------

Q. Как сделать текущий модуль главным?
A. Главный наш модуль:

1) Помечен комментом (*$MAIN*)
2) Присутствует в менюшке в поле Main Module, где его имя написано без расширения
3) Не присуствует в поле Modules

То есть если надо какой-то модуль сделать главным, пишем в нём (*$MAIN*),
добавляем его имя в Main Module и убираем из Modules, если он там конечно был.
И обязательно нажимаем Save.

--------------------------------------------------------------------------------
